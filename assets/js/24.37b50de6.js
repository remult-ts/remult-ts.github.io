(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{471:function(t,s,a){"use strict";a.r(s);var e=a(114),n=Object(e.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"users-and-security"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#users-and-security"}},[t._v("#")]),t._v(" Users and Security")]),t._v(" "),a("p",[t._v("The next thing on our feature list is managing users and security for the application.")]),t._v(" "),a("p",[t._v("We want users to be able to register and sign in to the application, and we want to have a role based system where:")]),t._v(" "),a("ol",[a("li",[t._v("Only admin users can update Products")]),t._v(" "),a("li",[t._v("Non signed in users can only view the products and register if they want.")])]),t._v(" "),a("p",[t._v("We already have a built in security implementation that can do this, let's review how we use it and how it works.")]),t._v(" "),a("h2",{attrs:{id:"creating-the-first-user"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#creating-the-first-user"}},[t._v("#")]),t._v(" Creating the first user")]),t._v(" "),a("p",[t._v("We need to create our first user, to do that simply click on the "),a("code",[t._v("Register")]),t._v(" menu entry, enter your info and click "),a("code",[t._v("Register")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/2019-10-08_11h09_40.png",alt:""}})]),t._v(" "),a("p",[t._v("Now that you are signed in you can see your name at the top right toolbar, and you can click it to signout.")]),t._v(" "),a("p",[a("img",{attrs:{src:"/2019-10-08_11h16_54.png",alt:""}})]),t._v(" "),a("p",[t._v("After you sign out, you can click the "),a("code",[t._v("sign in")]),t._v(" button at the top right and enter your name and password to sign in again.")]),t._v(" "),a("h2",{attrs:{id:"user-management"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#user-management"}},[t._v("#")]),t._v(" User Management")]),t._v(" "),a("p",[t._v("The first user that signs in is by default the application's "),a("code",[t._v("Admin")]),t._v(" and has access to the "),a("code",[t._v("User Accounts")]),t._v(" menu entry where users can be managed.")]),t._v(" "),a("p",[a("img",{attrs:{src:"/2019-10-08_11h20_28.png",alt:""}})]),t._v(" "),a("p",[t._v("Here you can manage the users and even reset their password.")]),t._v(" "),a("h2",{attrs:{id:"securing-the-products"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#securing-the-products"}},[t._v("#")]),t._v(" Securing the Products")]),t._v(" "),a("p",[t._v("Now that we understand how users can be managed, let's start securing the application by restricting access to the "),a("code",[t._v("Products")]),t._v(".")]),t._v(" "),a("p",[t._v("In the "),a("code",[t._v("products.ts")])]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" IdEntity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" StringColumn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" EntityClass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NumberColumn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" DateColumn "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@remult/core'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\r\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Roles "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../users/roles'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\r\n\r\n@EntityClass\r\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Products")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IdEntity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\r\n    name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringColumn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\r\n    price "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NumberColumn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\r\n    availableFrom "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DateColumn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\r\n    availableTo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DateColumn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\r\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\r\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\r\n            name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Products"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\r\n            allowApiCRUD"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("Roles"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\r\n            allowApiRead"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\r\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\r\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\r\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" ")])])]),a("p",[t._v("We've changed the "),a("code",[t._v("allowApiCRUD")]),t._v(" property to only allow it for users that has the role "),a("code",[t._v("Roles.admin")]),t._v(" (later we'll define new roles)\nWe've kept the "),a("code",[t._v("allowApiRead")]),t._v(" to true, since even non signed in users can view products in the "),a("code",[t._v("home.component.ts")])]),t._v(" "),a("p",[t._v("This step has secured the "),a("code",[t._v("API")]),t._v(" which means that even someone who is accessing our server directly, without the application can't update the categories if they are not authorized to do so.")]),t._v(" "),a("p",[t._v("Next we'll secure the "),a("code",[t._v("updatePriceOnServer")]),t._v(" server function we've used in the "),a("code",[t._v("products.component.ts")])]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[t._v("@"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ServerFunction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("allowed"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("Roles"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("updatePriceOnServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("priceToUpdate"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("Context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n")])])]),a("p",[t._v("We've set the "),a("code",[t._v("allowed")]),t._v(" property to the "),a("code",[t._v("Roles.admin")]),t._v(" role.")]),t._v(" "),a("p",[t._v("Next let's restrict access to the "),a("code",[t._v("products.component.ts")]),t._v(" for the users themselves")]),t._v(" "),a("p",[t._v("In the "),a("code",[t._v("app-routing.module.ts")])]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" routes"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Routes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//other routes")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Products'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" component"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ProductsComponent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" canActivate"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("AdminGuard"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//other routes")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("We've added the "),a("code",[t._v(", canActivate: [AdminGuard]")]),t._v(" definition to the "),a("code",[t._v("Products")]),t._v(" path. This means that a user that does not have the "),a("code",[t._v("admin")]),t._v(" role, will not be able to access the categories entry in the menu.\n||| tip\nCreate another user, without admin privliges and see  how that works.\n|||\nNow that you know about the "),a("code",[t._v("canActivate")]),t._v(" you can see that several of the prepared routes are using similar guards:")]),t._v(" "),a("ol",[a("li",[t._v("AdminGuard - only users that have the "),a("code",[t._v("Admin")]),t._v(" role.")]),t._v(" "),a("li",[t._v("NotSignedInGuard - only users that are not Signed in.")]),t._v(" "),a("li",[t._v("SignedInGuard - only users that are signed in.")])])])},[],!1,null,null,null);s.default=n.exports}}]);